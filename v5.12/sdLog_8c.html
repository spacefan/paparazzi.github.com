<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Paparazzi UAS: sw/airborne/modules/loggers/sdlog_chibios/sdLog.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="penguin_icon.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Paparazzi UAS
   &#160;<span id="projectnumber">v5.12_stable-2-g9c592a7-dirty</span>
   </div>
   <div id="projectbrief">Paparazzi is a free software Unmanned Aircraft System.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sdLog_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sdLog.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;ch.h&gt;</code><br />
<code>#include &lt;hal.h&gt;</code><br />
<code>#include &lt;ff.h&gt;</code><br />
<code>#include &quot;<a class="el" href="sdLog_8h_source.html">modules/loggers/sdlog_chibios/sdLog.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="printf_8h_source.html">printf.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sdio_8h_source.html">mcu_periph/sdio.h</a>&quot;</code><br />
<code>#include &lt;ctype.h&gt;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for sdLog.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c__incl.png" border="0" usemap="#sw_2airborne_2modules_2loggers_2sdlog__chibios_2sdLog_8c" alt=""/></div>
<map name="sw_2airborne_2modules_2loggers_2sdlog__chibios_2sdLog_8c" id="sw_2airborne_2modules_2loggers_2sdlog__chibios_2sdLog_8c">
<area shape="rect" id="node7" href="sdLog_8h.html" title="modules/loggers/sdlog\l_chibios/sdLog.h" alt="" coords="385,109,552,151"/><area shape="rect" id="node11" href="printf_8h.html" title="Mini printf&#45;like functionality. " alt="" coords="294,117,361,143"/><area shape="rect" id="node12" href="sdio_8h.html" title="arch independent SDIO API " alt="" coords="643,117,782,143"/></map>
</div>
</div>
<p><a href="sdLog_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a217a0bd562b98ae8c2ffce44935351e1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a217a0bd562b98ae8c2ffce44935351e1">likely</a>(x)&#160;&#160;&#160;__builtin_expect(!!(x), 1)</td></tr>
<tr class="separator:a217a0bd562b98ae8c2ffce44935351e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6c45889010c1bd68631771b64f18101"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(x)&#160;&#160;&#160;__builtin_expect(!!(x), 0)</td></tr>
<tr class="separator:ac6c45889010c1bd68631771b64f18101"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74e75242132eaabbc1c512488a135926"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a74e75242132eaabbc1c512488a135926">MIN</a>(x, y)&#160;&#160;&#160;(((x) &lt; (y)) ? (x) : (y))</td></tr>
<tr class="separator:a74e75242132eaabbc1c512488a135926"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacc3ee1a7f283f8ef65cea31f4436a95"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>(x, y)&#160;&#160;&#160;(((x) &gt; (y)) ? (x) : (y))</td></tr>
<tr class="separator:aacc3ee1a7f283f8ef65cea31f4436a95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4922593f9f95a4fabc34eacf23ac4550"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a4922593f9f95a4fabc34eacf23ac4550">IS_POWER_OF_TWO</a>(s)&#160;&#160;&#160;((s) &amp;&amp; !((s) &amp; ((s) - 1)))</td></tr>
<tr class="separator:a4922593f9f95a4fabc34eacf23ac4550"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1cf68ce7e74ae0b79f57bbc3f7d2b77"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#af1cf68ce7e74ae0b79f57bbc3f7d2b77">SDLOG_WRITE_BUFFER_SIZE</a>&#160;&#160;&#160;(<a class="el" href="px4fmu_2chibios_2v2_84_2mcuconf_8h.html#abf3ea4f6b58f67f72d53c6f7e35d76f0">SDLOG_ALL_BUFFERS_SIZE</a>/<a class="el" href="px4fmu_2chibios_2v2_84_2mcuconf_8h.html#abfa7a6086a22ce269b39b1a7cd3ca4a1">SDLOG_NUM_FILES</a>)</td></tr>
<tr class="separator:af1cf68ce7e74ae0b79f57bbc3f7d2b77"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae82bd97eb545159246a84ebf2233421f"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#ae82bd97eb545159246a84ebf2233421f">IN_DMA_SECTION</a> (FATFS fatfs)</td></tr>
<tr class="separator:ae82bd97eb545159246a84ebf2233421f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fbab9a978291b87726867c0dcb05b81"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="types_8h.html#a2ba621978a511250f7250fb10e05ffbe">int32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a4fbab9a978291b87726867c0dcb05b81">uiGetIndexOfLogFile</a> (const char *prefix, const char *fileName)</td></tr>
<tr class="separator:a4fbab9a978291b87726867c0dcb05b81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a870830d3ea4fe67badf79e52582f4fae"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a870830d3ea4fe67badf79e52582f4fae">flushWriteByteBuffer</a> (const <a class="el" href="sdLog_8h.html#a5af0a3873249752407b6c26c77c9a46d">FileDes</a> <a class="el" href="bat__voltage__ardrone2_8c.html#a6f8059414f0228f0256115e024eeed4b">fd</a>)</td></tr>
<tr class="separator:a870830d3ea4fe67badf79e52582f4fae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a598888320386c21f975d32d68f29bcf3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a598888320386c21f975d32d68f29bcf3">sdLogInit</a> (<a class="el" href="types_8h.html#a06896e8c53f721507066c079052171f8">uint32_t</a> *freeSpaceInKo)</td></tr>
<tr class="memdesc:a598888320386c21f975d32d68f29bcf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialise sdLog  <a href="#a598888320386c21f975d32d68f29bcf3">More...</a><br /></td></tr>
<tr class="separator:a598888320386c21f975d32d68f29bcf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03326adcb90b1cc07d684a6abaff2051"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a03326adcb90b1cc07d684a6abaff2051">sdLogFinish</a> (void)</td></tr>
<tr class="memdesc:a03326adcb90b1cc07d684a6abaff2051"><td class="mdescLeft">&#160;</td><td class="mdescRight">unmount filesystem  <a href="#a03326adcb90b1cc07d684a6abaff2051">More...</a><br /></td></tr>
<tr class="separator:a03326adcb90b1cc07d684a6abaff2051"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a510de29d16898e7e402fe7ea2dc7b992"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a510de29d16898e7e402fe7ea2dc7b992">getFileName</a> (const char *prefix, const char *directoryName, char *nextFileName, const size_t nameLength, const int indexOffset)</td></tr>
<tr class="memdesc:a510de29d16898e7e402fe7ea2dc7b992"><td class="mdescLeft">&#160;</td><td class="mdescRight">get last used name for a pattern, then add offset and return valid filename  <a href="#a510de29d16898e7e402fe7ea2dc7b992">More...</a><br /></td></tr>
<tr class="separator:a510de29d16898e7e402fe7ea2dc7b992"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0feebb43817c3a4d97e34f991012932c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sdLog_8c.html#a0feebb43817c3a4d97e34f991012932c">removeEmptyLogs</a> (const char *directoryName, const char *prefix, const size_t sizeConsideredEmpty)</td></tr>
<tr class="memdesc:a0feebb43817c3a4d97e34f991012932c"><td class="mdescLeft">&#160;</td><td class="mdescRight">remove spurious log file left on sd  <a href="#a0feebb43817c3a4d97e34f991012932c">More...</a><br /></td></tr>
<tr class="separator:a0feebb43817c3a4d97e34f991012932c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a4922593f9f95a4fabc34eacf23ac4550"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_POWER_OF_TWO</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">s</td><td>)</td>
          <td>&#160;&#160;&#160;((s) &amp;&amp; !((s) &amp; ((s) - 1)))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00043">43</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<a class="anchor" id="a217a0bd562b98ae8c2ffce44935351e1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define likely</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;__builtin_expect(!!(x), 1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00038">38</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<a class="anchor" id="aacc3ee1a7f283f8ef65cea31f4436a95"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">y&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(((x) &gt; (y)) ? (x) : (y))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00042">42</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p>Referenced by <a class="el" href="sdLog_8c_source.html#l00722">getFileName()</a>.</p>

</div>
</div>
<a class="anchor" id="a74e75242132eaabbc1c512488a135926"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">y&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(((x) &lt; (y)) ? (x) : (y))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00041">41</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p>Referenced by <a class="el" href="sdLog_8c_source.html#l00722">getFileName()</a>.</p>

</div>
</div>
<a class="anchor" id="af1cf68ce7e74ae0b79f57bbc3f7d2b77"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SDLOG_WRITE_BUFFER_SIZE&#160;&#160;&#160;(<a class="el" href="px4fmu_2chibios_2v2_84_2mcuconf_8h.html#abf3ea4f6b58f67f72d53c6f7e35d76f0">SDLOG_ALL_BUFFERS_SIZE</a>/<a class="el" href="px4fmu_2chibios_2v2_84_2mcuconf_8h.html#abfa7a6086a22ce269b39b1a7cd3ca4a1">SDLOG_NUM_FILES</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00069">69</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac6c45889010c1bd68631771b64f18101"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define unlikely</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;__builtin_expect(!!(x), 0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00039">39</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a870830d3ea4fe67badf79e52582f4fae"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> flushWriteByteBuffer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="sdLog_8h.html#a5af0a3873249752407b6c26c77c9a46d">FileDes</a>&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a510de29d16898e7e402fe7ea2dc7b992"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> getFileName </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>directoryName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>nextFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>nameLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>indexOffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get last used name for a pattern, then add offset and return valid filename </p>
<p>for log file, you often have a pattern and a version. To retreive last file for reading, call function with indexOffset=0. To get next available file for writing, call function with indexOffset=1 This function is available even without thread login facility : even if SDLOG_XXX macro are zeroed </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">prefix</td><td>: the pattern for the file : example LOG_ </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">directoryName</td><td>: root directory where to find file </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nextFileName</td><td>: file with path ready to be used for f_open system call </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nameLength</td><td>: length of previous buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">indexOffset</td><td>: use 0 to retrieve last existent filename, 1 for next filename </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status (always check status) </dd></dl>

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00722">722</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p>References <a class="el" href="printf_8c_source.html#l00377">chsnprintf()</a>, <a class="el" href="sdLog_8c_source.html#l00042">MAX</a>, <a class="el" href="sdLog_8c_source.html#l00041">MIN</a>, <a class="el" href="sdLog_8h_source.html#l00036">NUMBERFMF</a>, <a class="el" href="sdLog_8h_source.html#l00035">NUMBERMAX</a>, <a class="el" href="sdLog_8h_source.html#l00110">SDLOG_FATFS_ERROR</a>, <a class="el" href="sdLog_8h_source.html#l00119">SDLOG_LOGNUM_ERROR</a>, <a class="el" href="sdLog_8h_source.html#l00108">SDLOG_OK</a>, and <a class="el" href="sdLog_8c_source.html#l00843">uiGetIndexOfLogFile()</a>.</p>

<p><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a510de29d16898e7e402fe7ea2dc7b992_cgraph.png" border="0" usemap="#sdLog_8c_a510de29d16898e7e402fe7ea2dc7b992_cgraph" alt=""/></div>
<map name="sdLog_8c_a510de29d16898e7e402fe7ea2dc7b992_cgraph" id="sdLog_8c_a510de29d16898e7e402fe7ea2dc7b992_cgraph">
<area shape="rect" id="node2" href="group__chprintf.html#gabe5c0e0148763ecfd7829f6129f29e0a" title="chsnprintf" alt="" coords="187,13,272,39"/><area shape="rect" id="node6" href="sdLog_8c.html#a4fbab9a978291b87726867c0dcb05b81" title="uiGetIndexOfLogFile" alt="" coords="156,63,303,90"/><area shape="rect" id="node3" href="group__chprintf.html#gaa4e64308af46238224f455c00a4fcf26" title="System formatted output function. " alt="" coords="351,13,449,39"/><area shape="rect" id="node4" href="group__chprintf.html#gac5d948ddbb98eeaf4c395f12d1673e2e" title="ltoa" alt="" coords="497,13,544,39"/><area shape="rect" id="node5" href="group__chprintf.html#ga083a2bdcd3b67b7be94900e8affc57b8" title="long_to_string_with\l_divisor" alt="" coords="592,5,736,47"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae82bd97eb545159246a84ebf2233421f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IN_DMA_SECTION </td>
          <td>(</td>
          <td class="paramtype">FATFS&#160;</td>
          <td class="paramname"><em>fatfs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a0feebb43817c3a4d97e34f991012932c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> removeEmptyLogs </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>directoryName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>sizeConsideredEmpty</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>remove spurious log file left on sd </p>
<p>when tuning firmware, log files are created at each tries, and we consider that empty or nearly empty log are of no value this function remove log file whose size is less than a given value</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">prefix</td><td>: the pattern for the file : example LOG_ </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">directoryName</td><td>: root directory where to find file </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sizeConsideredEmpty</td><td>: file whose size is less or equal to that value will be removed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status (always check status) </dd></dl>

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00783">783</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p>References <a class="el" href="sdLog_8h_source.html#l00110">SDLOG_FATFS_ERROR</a>, <a class="el" href="sdLog_8h_source.html#l00111">SDLOG_FATFS_NOENT</a>, and <a class="el" href="sdLog_8h_source.html#l00108">SDLOG_OK</a>.</p>

<p>Referenced by <a class="el" href="sdlog__chibios_8c_source.html#l00198">thd_startlog()</a>.</p>

<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a0feebb43817c3a4d97e34f991012932c_icgraph.png" border="0" usemap="#sdLog_8c_a0feebb43817c3a4d97e34f991012932c_icgraph" alt=""/></div>
<map name="sdLog_8c_a0feebb43817c3a4d97e34f991012932c_icgraph" id="sdLog_8c_a0feebb43817c3a4d97e34f991012932c_icgraph">
<area shape="rect" id="node2" href="sdlog__chibios_8c.html#a7cf4c749454b496e749b47e614750109" title="thd_startlog" alt="" coords="196,5,295,32"/><area shape="rect" id="node3" href="sdlog__chibios_8h.html#aeeba7682db35a9becddc07935f5d256a" title="sdlog_chibios_init" alt="" coords="343,5,476,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a03326adcb90b1cc07d684a6abaff2051"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> sdLogFinish </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>unmount filesystem </p>
<p>unmount filesystem, free sdio peripheral This function is available even without thread login facility : even if SDLOG_XXX macro are zeroed </p><dl class="section return"><dt>Returns</dt><dd>status (always check status) </dd></dl>

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00253">253</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p>References <a class="el" href="sdLog_8h_source.html#l00110">SDLOG_FATFS_ERROR</a>, and <a class="el" href="sdLog_8h_source.html#l00108">SDLOG_OK</a>.</p>

<p>Referenced by <a class="el" href="sdlog__chibios_8c_source.html#l00182">sdlog_chibios_finish()</a>.</p>

<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a03326adcb90b1cc07d684a6abaff2051_icgraph.png" border="0" usemap="#sdLog_8c_a03326adcb90b1cc07d684a6abaff2051_icgraph" alt=""/></div>
<map name="sdLog_8c_a03326adcb90b1cc07d684a6abaff2051_icgraph" id="sdLog_8c_a03326adcb90b1cc07d684a6abaff2051_icgraph">
<area shape="rect" id="node2" href="sdlog__chibios_8h.html#a468073a8575335ab6b2d8291548e78ff" title="sdlog_chibios_finish" alt="" coords="148,31,295,57"/><area shape="rect" id="node3" href="sdlog__chibios_8c.html#aee744de53d121395ef522cef118be731" title="thd_bat_survey" alt="" coords="343,5,463,32"/><area shape="rect" id="node6" href="usbStorage_8c.html#a03e36a472f457f472fc7031d798eac45" title="thdUsbStorage" alt="" coords="343,56,462,83"/><area shape="rect" id="node4" href="sdlog__chibios_8c.html#a7cf4c749454b496e749b47e614750109" title="thd_startlog" alt="" coords="546,5,645,32"/><area shape="rect" id="node5" href="sdlog__chibios_8h.html#aeeba7682db35a9becddc07935f5d256a" title="sdlog_chibios_init" alt="" coords="728,31,861,57"/><area shape="rect" id="node7" href="usbStorage_8h.html#a12081a3972cd8a738a527d104c647665" title="usbStorageStartPolling" alt="" coords="511,56,680,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a598888320386c21f975d32d68f29bcf3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sdLog_8h.html#ae9361ce95c5a174983481365e90d87b3">SdioError</a> sdLogInit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#a06896e8c53f721507066c079052171f8">uint32_t</a> *&#160;</td>
          <td class="paramname"><em>freeSpaceInKo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialise sdLog </p>
<p>init sdio peripheral, verify sdCard is inserted, check and mount filesystem, launch worker thread This function is available even without thread login facility : even if SDLOG_XXX macro are zeroed </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">freeSpaceInKo</td><td>: if pointer in nonnull, return free space on filesystem </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status (always check status) </dd></dl>

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00193">193</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p>References <a class="el" href="std_8h_source.html#l00005">FALSE</a>, <a class="el" href="tlsf__malloc__arch_8h_source.html#l00044">HEAP_DEFAULT</a>, <a class="el" href="msg__queue_8c_source.html#l00042">msgqueue_init()</a>, <a class="el" href="sdio__arch_8c_source.html#l00048">sdio_connect()</a>, <a class="el" href="sdio__arch_8c_source.html#l00087">sdio_disconnect()</a>, <a class="el" href="sdLog_8h_source.html#l00110">SDLOG_FATFS_ERROR</a>, <a class="el" href="sdLog_8h_source.html#l00109">SDLOG_NOCARD</a>, <a class="el" href="apogee_2chibios_2v1_80_2mcuconf_8h_source.html#l00389">SDLOG_NUM_FILES</a>, <a class="el" href="sdLog_8h_source.html#l00108">SDLOG_OK</a>, <a class="el" href="apogee_2chibios_2v1_80_2mcuconf_8h_source.html#l00387">SDLOG_QUEUE_BUCKETS</a>, and <a class="el" href="sdLog_8h_source.html#l00120">SDLOG_WAS_LAUNCHED</a>.</p>

<p>Referenced by <a class="el" href="sdlog__chibios_8c_source.html#l00198">thd_startlog()</a>.</p>

<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a598888320386c21f975d32d68f29bcf3_cgraph.png" border="0" usemap="#sdLog_8c_a598888320386c21f975d32d68f29bcf3_cgraph" alt=""/></div>
<map name="sdLog_8c_a598888320386c21f975d32d68f29bcf3_cgraph" id="sdLog_8c_a598888320386c21f975d32d68f29bcf3_cgraph">
<area shape="rect" id="node2" href="msg__queue_8c.html#a8cbe13f6801caa6bd92498e5772eb3df" title="initialise MsgQueue " alt="" coords="136,5,252,32"/><area shape="rect" id="node3" href="sdio__arch_8c.html#a55d0f878fb169bbdd445d86648ee562b" title="Connect a SD card on SDIO peripheral. " alt="" coords="141,56,247,83"/><area shape="rect" id="node4" href="sdio__arch_8c.html#a1aaca4bd6a01a576869aa133f5fe0877" title="Disconnect a SD card on SDIO peripheral. " alt="" coords="132,107,256,133"/></map>
</div>
</p>

<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a598888320386c21f975d32d68f29bcf3_icgraph.png" border="0" usemap="#sdLog_8c_a598888320386c21f975d32d68f29bcf3_icgraph" alt=""/></div>
<map name="sdLog_8c_a598888320386c21f975d32d68f29bcf3_icgraph" id="sdLog_8c_a598888320386c21f975d32d68f29bcf3_icgraph">
<area shape="rect" id="node2" href="sdlog__chibios_8c.html#a7cf4c749454b496e749b47e614750109" title="thd_startlog" alt="" coords="132,5,231,32"/><area shape="rect" id="node3" href="sdlog__chibios_8h.html#aeeba7682db35a9becddc07935f5d256a" title="sdlog_chibios_init" alt="" coords="279,5,412,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4fbab9a978291b87726867c0dcb05b81"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a2ba621978a511250f7250fb10e05ffbe">int32_t</a> uiGetIndexOfLogFile </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fileName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sdLog_8c_source.html#l00843">843</a> of file <a class="el" href="sdLog_8c_source.html">sdLog.c</a>.</p>

<p>Referenced by <a class="el" href="sdLog_8c_source.html#l00722">getFileName()</a>.</p>

<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sdLog_8c_a4fbab9a978291b87726867c0dcb05b81_icgraph.png" border="0" usemap="#sdLog_8c_a4fbab9a978291b87726867c0dcb05b81_icgraph" alt=""/></div>
<map name="sdLog_8c_a4fbab9a978291b87726867c0dcb05b81_icgraph" id="sdLog_8c_a4fbab9a978291b87726867c0dcb05b81_icgraph">
<area shape="rect" id="node2" href="sdLog_8h.html#a510de29d16898e7e402fe7ea2dc7b992" title="get last used name for a pattern, then add offset and return valid filename " alt="" coords="200,5,303,32"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_01fcd3835fb4e7d9331b722d86291b65.html">sw</a></li><li class="navelem"><a class="el" href="dir_5e9153041680afc3c016fd52fa730b56.html">airborne</a></li><li class="navelem"><a class="el" href="dir_c2abcdd6ccb39c3582929c0e3f5651c2.html">modules</a></li><li class="navelem"><a class="el" href="dir_cbf4be70f5fb954ea1d2a546dd70b40e.html">loggers</a></li><li class="navelem"><a class="el" href="dir_c27662836f6a804eadd3e3b5df5506a4.html">sdlog_chibios</a></li><li class="navelem"><a class="el" href="sdLog_8c.html">sdLog.c</a></li>
    <li class="footer">Generated on Wed Nov 8 2017 12:03:10 for Paparazzi UAS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
